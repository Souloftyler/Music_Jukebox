<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Grimoire Royal - L'Aetherium Compendium</title>
    <!-- Chargement de Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'parchment-base': '#fcf4d4', 
                        'parchment-shadow': '#e0cdb2', 
                        'ink-dark': '#301f14', 
                        'ornate-gold': '#cdac60', 
                        'royal-blue': '#3e5c76', 
                    },
                    fontFamily: {
                        title: ['Uncial Antiqua', 'Cinzel', 'serif'],
                        body: ['IM Fell English', 'serif'],
                    },
                    boxShadow: {
                        'grimoire-3d': '10px 10px 40px rgba(0,0,0,0.7)',
                    }
                }
            }
        }

        // --- Données du Jeu (Narrative Game Data) ---
        const gameData = {
            "start": {
                title: "L'Aube du Mystère",
                text: "Vous vous réveillez dans une chambre froide, l'odeur de la moisissure et de l'encre ancienne pique vos narines. Le Compendium des Secrets Hermétiques (ce grimoire) repose ouvert à vos côtés. Le soleil n'est pas encore levé. Vous entendez des pas lourds qui s'approchent du corridor extérieur. Que faites-vous ?",
                choices: [
                    { text: "Attraper le grimoire et vous cacher sous le lit.", target: "folio_1" },
                    { text: "Vous lever et chercher une arme.", target: "folio_2" },
                    { text: "Faire semblant de dormir, en espérant qu'ils passent.", target: "folio_3" }
                ]
            },
            "folio_1": {
                title: "Le Refuge Précipité (Folio 1)",
                text: "Vous vous glissez sous le lit, le cœur battant. Le grimoire est lourd et froid. La porte s'ouvre avec un grincement sinistre. Deux silhouettes encapuchonnées entrent. Elles fouillent la chambre mais ne regardent pas sous le lit. Après un temps infini, elles partent. Vous sortez de votre cachette.",
                choices: [
                    { text: "Examiner la pièce qu'elles ont fouillée.", target: "folio_4" },
                    { text: "Ouvrir le grimoire à la première page lue.", target: "folio_5" }
                ]
            },
            "folio_2": {
                title: "L'Imprudence Armée (Folio 2)",
                text: "Vous vous levez et trouvez un petit tisonnier rouillé près de la cheminée. Les pas sont désormais juste derrière la porte. Vous vous tenez prêt. La porte s'ouvre et les deux hommes encapuchonnés vous voient. Ils rient et l'un d'eux lève une hache. Vous êtes trop lent.",
                choices: [
                    { text: "FIN : Échec.", target: "end_fail" }
                ]
            },
            "folio_3": {
                title: "Le Risque du Sommeil (Folio 3)",
                text: "Vous fermez les yeux, retenant votre souffle. Les pas s'arrêtent. Un silence s'installe. Puis, un rire sec éclate juste au-dessus de vous. Une main gantée vous saisit la cheville et vous tire hors du lit. Vous avez été découvert.",
                choices: [
                    { text: "FIN : Capture.", target: "end_fail" }
                ]
            },
            "folio_4": {
                title: "Traces de Passage (Folio 4)",
                text: "Vous fouillez la pièce. Sur la table, vous trouvez une carte rudimentaire déchirée et un sachet contenant trois pièces d'or. La carte montre un chemin vers les 'Terres Brûlées'. Le soleil se lève, le couloir est libre. Que faites-vous ?",
                choices: [
                    { text: "Prendre les pièces et suivre le chemin indiqué sur la carte.", target: "folio_6" },
                    { text: "Ignorer la carte, prendre les pièces et chercher une autre sortie.", target: "folio_7" }
                ]
            },
            "folio_5": {
                title: "Le Savoir Dévoilé (Folio 5)",
                text: "Vous ouvrez le grimoire. Les pages 4 et 5 contiennent la 'Proclamation des Anciens' que vous avez déjà lue, mais un ajout manuscrit attire votre attention. Il dit : 'La sortie est sous le sceau brisé.' Vous examinez le sol.",
                choices: [
                    { text: "Chercher le sceau brisé sur le sol.", target: "folio_8" },
                    { text: "Ignorer l'inscription et prendre la fuite par la porte principale.", target: "folio_7" }
                ]
            },
            "folio_6": {
                title: "Terres Brûlées (Folio 6)",
                text: "Après des heures de marche, la carte vous a mené à une plaine stérile et fumante. Un dragon rouge planant au-dessus des montagnes vous repère. Sa fureur est sans borne. Vous n'avez aucune chance de vous enfuir.",
                choices: [
                    { text: "FIN : Brûlé vif.", target: "end_fail" }
                ]
            },
            "folio_7": {
                title: "Fuite Incertaine (Folio 7)",
                text: "Vous vous précipitez hors de la chambre. Vous courez dans un long couloir sombre. Au bout, vous apercevez une porte en bois. Vous l'ouvrez et vous vous trouvez face à un précipice. Le couloir est une impasse. Un cri d'alarme retentit derrière vous.",
                choices: [
                    { text: "FIN : Piégé.", target: "end_fail" }
                ]
            },
            "folio_8": {
                title: "Le Passage Secret (Folio 8)",
                text: "Sous le lit se trouve un symbole gravé, brisé en son centre. En poussant sur le fragment manquant, un mécanisme se déclenche. Une trappe s'ouvre, révélant un escalier sombre. Vous y descendez rapidement, le grimoire sous le bras. Vous avez échappé à la capture.",
                choices: [
                    { text: "FIN : Victoire. Vous avez survécu à l'aube.", target: "end_success" }
                ]
            },
            "end_fail": {
                title: "Fin de l'Aventure",
                text: "Votre voyage s'arrête ici. Vos choix vous ont mené à une fin prématurée. Relisez le Compendium et tentez à nouveau de percer les secrets de l'Aetherium.",
                choices: [
                    { text: "Recommencer.", target: "start" }
                ]
            },
            "end_success": {
                title: "La Lumière du Matin",
                text: "Vous émergez des souterrains, aveuglé par le soleil. Le grimoire est votre seul allié. L'aventure ne fait que commencer. Vous avez réussi le premier chapitre.",
                choices: [
                    { text: "Recommencer.", target: "start" }
                ]
            }
        };

        // Roman Numeral Converter - Mappage sûr pour la conversion
        const romanNumerals = [
            { value: 1000, numeral: 'M' },
            { value: 900, numeral: 'CM' },
            { value: 500, numeral: 'D' },
            { value: 400, numeral: 'CD' },
            { value: 100, numeral: 'C' },
            { value: 90, numeral: 'XC' },
            { value: 50, numeral: 'L' },
            { value: 40, numeral: 'XL' },
            { value: 10, numeral: 'X' },
            { value: 9, numeral: 'IX' },
            { value: 5, numeral: 'V' },
            { value: 4, numeral: 'IV' },
            { value: 1, numeral: 'I' }
        ];

        /**
         * Convertit un nombre arabe en chiffre romain.
         * @param {number} num Le nombre à convertir.
         * @returns {string} Le chiffre romain correspondant ou le nombre original en cas d'erreur.
         */
        function toRoman(num) {
            if (typeof num !== 'number' || isNaN(num) || num <= 0 || num > 3999) return String(num); 
            let roman = '';
            let currentNum = num;

            for (let i = 0; i < romanNumerals.length; i++) {
                while (currentNum >= romanNumerals[i].value) {
                    roman += romanNumerals[i].numeral;
                    currentNum -= romanNumerals[i].value;
                }
            }
            return roman;
        }

        // --- Configuration et Utilitaire API ---
        const apiKey = ""; // L'API key est fournie par l'environnement Canvas
        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/imagen-4.0-generate-001:predict?key=${apiKey}`;

        // Utility pour la relance avec backoff exponentiel
        async function retryFetch(url, options, maxRetries = 3) {
            for (let i = 0; i < maxRetries; i++) {
                try {
                    const response = await fetch(url, options);
                    if (response.status === 429 && i < maxRetries - 1) {
                        const delay = Math.pow(2, i) * 1000 + Math.random() * 1000;
                        await new Promise(resolve => setTimeout(resolve, delay));
                        continue;
                    }
                    if (!response.ok) {
                        const errorBody = await response.text();
                        throw new Error(`HTTP error! status: ${response.status}. Body: ${errorBody}`);
                    }
                    return response;
                } catch (error) {
                    if (i === maxRetries - 1) {
                        throw error;
                    }
                    const delay = Math.pow(2, i) * 1000 + Math.random() * 1000;
                    await new Promise(resolve => setTimeout(resolve, delay));
                }
            }
        }

        // --- Fonctions de Gestion des Illustrations (Dynamique AI avec Fallback SVG) ---

        /**
         * Retourne le contenu SVG contextuel basé sur l'ID du Folio (Fallback)
         * Utilise des chemins SVG simples inspirés de Lucide Icons.
         */
        function getSvgFallback(folioId) {
            let svgPath = "";
            let iconClass = "h-9 w-9 text-royal-blue";
            let fallbackTitle = "Illustration";

            switch (folioId) {
                case "start":
                    // Livre ouvert (BookOpen)
                    svgPath = '<path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/>'; 
                    fallbackTitle = "Grimoire Ouvert";
                    break;
                case "folio_1":
                    // Oeil barré (EyeOff)
                    svgPath = '<path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.47 9.47 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.07 2.92M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0z"/><path d="M2 2l20 20"/>'; 
                    fallbackTitle = "Cachette";
                    break;
                case "folio_2":
                    // Épée et Bouclier stylisés
                    svgPath = '<path d="M20 9l-7-7-3 3-7 7 3 3 7 7 3-3z"/><path d="M12 4.5l-2.5 2.5"/><path d="M12 19.5l-2.5-2.5"/>'; 
                    fallbackTitle = "Conflit";
                    iconClass = "h-9 w-9 text-red-700";
                    break;
                case "folio_4":
                    // Boussole (Compass)
                    svgPath = '<path d="M12 20a8 8 0 1 0 0-16 8 8 0 0 0 0 16z"/><path d="M9 19 12 5 15 19 9 19z"/><path d="m14 14-3 3-3-3"/>';
                    fallbackTitle = "Trésor & Carte";
                    break;
                case "folio_5":
                    // Serrure (Lock) + Symbole Brisé
                    svgPath = '<rect width="18" height="11" x="3" y="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/><path d="M10 16h4"/><path d="M12 14v4"/>'; 
                    fallbackTitle = "Sceau Brisé";
                    break;
                case "folio_6":
                    // Flamme (Dragon/Danger)
                    svgPath = '<path d="M18 13.5A6.47 6.47 0 0 0 12 2c-3.1 0-6 2-6 5.5"/><path d="M12 22a4 4 0 0 0-4-4V6a4 4 0 0 0 4-4a4 4 0 0 0 4 4v12a4 4 0 0 0-4 4z"/>';
                    iconClass = "h-10 w-10 text-red-500";
                    fallbackTitle = "Menace Draconique";
                    break;
                case "folio_7":
                    // Symbole d'arrêt ou d'impasse (Square)
                    svgPath = '<rect width="18" height="18" x="3" y="3" rx="2" ry="2"/><path d="M9 9l6 6"/><path d="M15 9l-6 6"/>';
                    fallbackTitle = "Impasse";
                    iconClass = "h-8 w-8 text-ink-dark";
                    break;
                case "folio_8":
                    // Escalier ou trappe (Stairs)
                    svgPath = '<path d="m5 17 4-4 4 4 4-4 4 4"/><path d="m5 21 4-4 4 4 4-4 4 4"/><path d="M12 4h.01"/>'; 
                    fallbackTitle = "Passage Secret";
                    break;
                case "end_fail":
                    // Crâne (Skull)
                    svgPath = '<circle cx="12" cy="12" r="10"/><path d="M15 9l-6 6"/><path d="M9 9l6 6"/>'; 
                    iconClass = "h-9 w-9 text-red-900";
                    fallbackTitle = "Fin : Échec";
                    break;
                case "end_success":
                    // Soleil (Sun)
                    svgPath = '<circle cx="12" cy="12" r="10"/><path d="M12 2v2"/><path d="M12 20v2"/><path d="m4.93 4.93 1.41 1.41"/><path d="m17.66 17.66 1.41 1.41"/><path d="m2 12h2"/><path d="m20 12h2"/><path d="m6.34 17.66-1.41 1.41"/><path d="m19.07 4.93-1.41 1.41"/>'; 
                    iconClass = "h-10 w-10 text-ornate-gold";
                    fallbackTitle = "Fin : Victoire";
                    break;
                default:
                    // Encre et Plume (Ink/Quill)
                    svgPath = '<path d="M12 20h9"/><path d="M16.5 7.5l-9 9c-.63.63-.63 1.65 0 2.28L10 22l4.5-4.5 5.74-5.74a.5.5 0 0 0 .71 0z"/><path d="M12 12l2.5 2.5"/>'; 
                    fallbackTitle = "Mystère";
            }

            // SVG structure
            const svgContent = `
                <svg class="${iconClass} mb-1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                    ${svgPath}
                </svg>
            `;

            return { svgContent, fallbackTitle };
        }

        // Fonction pour générer le prompt stylisé pour l'IA
        function getFolioPrompt(folioId) {
            const defaultStyle = "enluminure détaillée, style dessin à l'encre médiéval, couleurs vives sur parchemin, ornementation florale et dorée, haute fantaisie, vue rapprochée de l'illustration.";
            
            let specificScene;
            switch (folioId) {
                case "start":
                    specificScene = "Une main tenant un livre ouvert (Grimoire) sur une table de bois, avec les ombres de personnages armés qui s'approchent sur le mur.";
                    break;
                case "folio_1":
                    specificScene = "Deux silhouettes encapuchonnées (des gardes) fouillant une chambre à coucher médiévale, ignorant une personne cachée sous le lit.";
                    break;
                case "folio_2":
                    specificScene = "Un tisonnier de cheminée rouillé brandi comme une arme, face à une grande hache levée par un garde.";
                    break;
                case "folio_4":
                    specificScene = "Un gros plan sur une carte en parchemin déchirée et trois pièces d'or brillante sur une table.";
                    break;
                case "folio_5":
                    specificScene = "Le sol d'une chambre avec un grand sceau ancien, brisé en son centre.";
                    break;
                case "folio_6":
                    specificScene = "Un grand dragon rouge survolant des montagnes fumantes, repérant une petite silhouette dans la plaine stérile.";
                    break;
                case "folio_8":
                    specificScene = "Une trappe en bois ou en pierre qui s'ouvre dans le sol, révélant un escalier sombre et tortueux vers le bas.";
                    break;
                case "end_success":
                    specificScene = "Une silhouette triomphante émergeant d'un tunnel souterrain dans la lumière vive du soleil matinal, tenant un livre précieux.";
                    break;
                default:
                    specificScene = "Un rouleau de parchemin ancien avec des écritures illisibles et une boussole arcanique.";
            }

            return `${specificScene}. ${defaultStyle}`; 
        }
        
        /**
         * Génère une image dynamique via l'API Google et l'affiche, ou un placeholder SVG en cas d'échec.
         * @param {string} folioId L'ID du Folio actuel.
         * @param {string} targetElementId L'ID de l'élément où insérer l'image.
         */
        async function generateIllustration(folioId, targetElementId) {
            const prompt = getFolioPrompt(folioId);
            const folioTextContent = document.getElementById(targetElementId);
            const currentText = folioTextContent.innerHTML;
            
            // 1. Créer et insérer l'indicateur de chargement (Spinner)
            const loadingHtml = `
                <div id="image-loading-container" class="enluminure-frame float-left mr-4 mb-2 w-32 h-32 flex flex-col items-center justify-center text-center bg-parchment-shadow/70 text-ink-dark/70 transform rotate-[-0.5deg]">
                    <svg class="animate-spin h-6 w-6 text-royal-blue" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                    <span class="mt-2 text-xs font-body">Création de l'Enluminure...</span>
                </div>
            `;
            // Insérer le chargement AVANT le texte pour qu'il flotte correctement
            folioTextContent.innerHTML = loadingHtml + currentText;
            
            const loadingContainer = document.getElementById('image-loading-container');

            // 2. Préparer la requête API
            const payload = {
                instances: [{ prompt: prompt }],
                parameters: { "sampleCount": 1 }
            };

            try {
                const response = await retryFetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const result = await response.json();
                const base64Data = result?.predictions?.[0]?.bytesBase64Encoded;
                
                if (base64Data) {
                    const imageUrl = `data:image/png;base64,${base64Data}`;
                    
                    // Créer l'élément Image
                    const img = document.createElement('img');
                    img.src = imageUrl;
                    img.alt = `Enluminure de la scène: ${prompt}`;
                    // Utiliser la même classe de cadre que le loading container
                    img.className = "enluminure-frame float-left mr-4 mb-2 w-32 h-32 object-cover bg-parchment-base";

                    // Remplacer le conteneur de chargement par l'image
                    if (loadingContainer) {
                        loadingContainer.parentNode.insertBefore(img, loadingContainer);
                        loadingContainer.remove();
                    }
                } else {
                    // Si l'API ne retourne pas de données, utiliser le fallback SVG
                    throw new Error("API did not return image data.");
                }

            } catch (error) {
                console.error("Erreur lors de la génération de l'image (l'IA est peut-être temporairement indisponible) :", error);
                
                // --- LOGIC POUR LE FALLBACK SVG CONTEXTUEL ---
                const { svgContent, fallbackTitle } = getSvgFallback(folioId);
                
                if (loadingContainer) {
                    // Conserver les classes de dimensionnement et de flottement, changer la couleur
                    loadingContainer.className = "enluminure-frame float-left mr-4 mb-2 w-32 h-32 flex flex-col items-center justify-center text-center bg-parchment-shadow/70 text-ink-dark/70 transform rotate-[-0.5deg]";
                    loadingContainer.innerHTML = `
                        ${svgContent}
                        <span class="mt-1 text-xs font-semibold font-body">${fallbackTitle}</span>
                    `; // Suppression de la mention "(Placeholder)"
                }
                // --- FIN LOGIC ---
            }
        }

        // Fonction pour charger un folio spécifique
        function loadFolio(folioId) {
            const folio = gameData[folioId];
            if (!folio) {
                console.error("Folio ID inconnu:", folioId);
                return;
            }

            document.getElementById('folio-title').textContent = folio.title;
            
            const folioTextContent = document.getElementById('folio-text-content');
            
            // 1. Vider l'ancien contenu
            folioTextContent.innerHTML = '';
            
            // 2. Insérer le texte (enveloppé dans un paragraphe pour la lettrine)
            const initialText = `<p class="story-paragraph">${folio.text.replace(/\n/g, '<br>')}</p>`;
            folioTextContent.innerHTML = initialText;

            // 3. Obtenir le prompt et lancer la fonction de gestion d'image dynamique (async)
            generateIllustration(folioId, 'folio-text-content'); 

            const choicesContainer = document.getElementById('folio-choices');
            choicesContainer.innerHTML = ''; // Nettoyer les anciens choix
            
            // --- Logique pour afficher le numéro de Folio en chiffres romains ---
            let folioLabel;
            if (folioId === 'start') {
                folioLabel = 'I';
            } else if (folioId.startsWith('folio_')) {
                const arabicNum = parseInt(folioId.replace('folio_', ''), 10);
                folioLabel = toRoman(arabicNum);
            } else {
                // Pour les états de fin (end_fail, end_success)
                folioLabel = 'FIN'; 
            }
            
            document.getElementById('folio-number').textContent = 'Folio ' + folioLabel;
            // --- Fin de la Logique de chiffres romains ---

            // Générer les nouveaux choix
            folio.choices.forEach((choice, index) => {
                const button = document.createElement('button');
                // Styles de bouton adaptés au thème Royal
                // Le w-full assure la réactivité sur mobile
                button.className = 'manuscript w-full text-left p-3 my-2 border border-royal-blue/50 rounded-lg bg-parchment-shadow hover:bg-parchment-base transition duration-150 shadow-md hover:shadow-lg focus:outline-none focus:ring-2 focus:ring-royal-blue/70';
                
                // Utilisation des chiffres romains pour les choix
                const choiceNumberRoman = toRoman(index + 1);
                button.textContent = `${choiceNumberRoman}. ${choice.text}`;
                
                button.onclick = () => loadFolio(choice.target);
                choicesContainer.appendChild(button);
            });
        }
        
        // Démarrer le jeu au chargement de la page
        window.onload = () => loadFolio("start");
    </script>
    <style>
        /* Importation des polices : Uncial Antiqua (Titres) et IM Fell English (Corps) */
        @import url('https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=IM+Fell+English:ital@0;1&family=Uncial+Antiqua&display=swap');
        
        /* Styles pour l'immersion Grimoire Royal High Fantasy */
        body {
            font-family: 'IM Fell English', serif; 
            /* Fond High Fantasy : Bleu Saphir */
            background-color: #3e5c76; 
            color: #301f14; 
            min-height: 100vh;
            display: flex;
            flex-direction: column; 
            justify-content: flex-start;
            align-items: center;
            padding: 10px 0; /* Padding réduit sur mobile */
            /* Ajout d'une texture pour l'ambiance royale/historique */
            background-image: linear-gradient(rgba(255,255,255,0.08) 1px, transparent 1px), linear-gradient(90deg, rgba(255,255,255,0.05) 1px, transparent 1px);
            background-size: 15px 15px;
        }
        @media (min-width: 640px) {
            body {
                padding: 20px 0; /* Plus de padding sur desktop */
            }
        }

        .audio-controls {
            max-width: 800px;
            width: 95%;
            margin-bottom: 20px;
            padding: 15px;
            background-color: #fcf4d4; 
            border: 2px solid #3e5c76; 
            border-radius: 8px;
            text-align: center;
        }
        
        .container {
            max-width: 800px;
            width: 95%;
            /* Fond Parchemin plus clair et jaune (authentique) */
            background-color: #fcf4d4;
            /* Bordure Noble : Bleu Saphir */
            border: 8px solid #3e5c76; 
            box-shadow: 10px 10px 30px rgba(0, 0, 0, 0.4);
            /* Petit effet de page courbée */
            transform: rotateZ(0.2deg); 
            line-height: 1.7; 
            letter-spacing: 0.05em; 
            padding: 1rem; /* Base padding réduit pour mobile */
            display: flex; 
            flex-direction: column;
            min-height: 700px;
        }
        @media (min-width: 640px) {
            .container {
                padding: 1.5rem 2rem; /* Plus de padding sur desktop */
            }
        }
        
        /* Style du texte manuscrit (adapté aux nouvelles couleurs) */
        .manuscript {
            color: #301f14; 
            line-height: 1.7;
            font-size: 1.1rem;
        }
        
        /* Titre orné (adapté aux nouvelles polices et couleurs) */
        .ornate-title {
            color: #cdac60; 
            text-shadow: 1px 1px 2px #3e5c76; 
            font-family: 'Uncial Antiqua', 'serif'; 
            letter-spacing: 2px;
            border-bottom: 3px solid #cdac60;
            display: inline-block;
            padding-bottom: 8px;
            margin-bottom: 1.5rem;
            font-weight: 700;
        }

        /* Nouveau style pour le cadre d'enluminure (appliqué au chargement et à l'image) */
        .enluminure-frame {
            border: 2px solid #cdac60; /* Ornementation dorée */
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            border-radius: 0.5rem; /* Coins légèrement arrondis */
            padding: 4px;
            transition: all 0.3s;
        }
        
        /* Styles spécifiques au jeu pour le premier mot en capitale (Lettrine) */
        /* Cible le premier paragraphe du contenu textuel, juste après l'image flottante */
        #folio-text-content .story-paragraph::first-letter {
            font-size: 3.5rem;
            line-height: 1;
            float: left;
            margin-right: 0.1em;
            color: #cdac60; 
            font-family: 'Uncial Antiqua', 'serif';
        }
    </style>
</head>
<body>

    <!-- Contrôles audio -->
    <div class="audio-controls">
        <p class="manuscript text-base italic">
            Ambiance sonore : <span class="font-title">Le Secret du Donjon</span>
        </p>
        <audio controls loop class="mt-2 w-full max-w-sm mx-auto">
            <source src="placeholder.mp3" type="audio/mpeg">
            Votre navigateur ne supporte pas l'élément audio.
        </audio>
    </div>

    <!-- Conteneur principal -->
    <div class="container">

        <!-- Partie Contenu du Folio -->
        <div class="flex-grow">
            <!-- Titre du Folio -->
            <h2 id="folio-title" class="text-3xl text-center ornate-title mx-auto">Chargement...</h2>
            
            <!-- Conteneur du Texte de l'histoire et de l'Illustration -->
            <div id="folio-text-content" class="manuscript mb-6 text-xl">
                <!-- L'image IA, le spinner ou le SVG de fallback sera inséré ici par JS -->
            </div>

            <!-- Conteneur des Choix -->
            <div id="folio-choices" class="mt-8 space-y-3">
                <!-- Les boutons de choix seront insérés ici par JavaScript -->
            </div>
        </div>
        
        <!-- Numéro du Folio en bas de page -->
        <div class="mt-auto text-right text-sm italic text-ink-dark/70 pt-4 border-t border-royal-blue/30">
            <span id="folio-number"></span>
        </div>
    </div>

</body>
</html>
